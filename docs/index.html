<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.287">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Wang">

<title>Macroeconometrics Research Report - Sign and Zero Restrictions: Optimism Shock on the Australian Business Cycle</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Macroeconometrics Research Report</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#acf-and-pacf-plot" id="toc-acf-and-pacf-plot" class="nav-link" data-scroll-target="#acf-and-pacf-plot">ACF and PACF plot</a></li>
  <li><a href="#augmented-dickey-fuller-test" id="toc-augmented-dickey-fuller-test" class="nav-link" data-scroll-target="#augmented-dickey-fuller-test">Augmented Dickey-Fuller test</a>
  <ul class="collapse">
  <li><a href="#level" id="toc-level" class="nav-link" data-scroll-target="#level">Level</a></li>
  <li><a href="#first-difference" id="toc-first-difference" class="nav-link" data-scroll-target="#first-difference">First difference</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a>
  <ul class="collapse">
  <li><a href="#specification" id="toc-specification" class="nav-link" data-scroll-target="#specification">Specification</a>
  <ul class="collapse">
  <li><a href="#structural-form" id="toc-structural-form" class="nav-link" data-scroll-target="#structural-form">Structural form</a></li>
  <li><a href="#reduced-form" id="toc-reduced-form" class="nav-link" data-scroll-target="#reduced-form">Reduced form</a></li>
  <li><a href="#orthogonal-reduced-form-parameterization" id="toc-orthogonal-reduced-form-parameterization" class="nav-link" data-scroll-target="#orthogonal-reduced-form-parameterization">Orthogonal reduced-form parameterization</a></li>
  </ul></li>
  <li><a href="#algorithm" id="toc-algorithm" class="nav-link" data-scroll-target="#algorithm">Algorithm</a>
  <ul class="collapse">
  <li><a href="#reduced-form-1" id="toc-reduced-form-1" class="nav-link" data-scroll-target="#reduced-form-1">Reduced form</a></li>
  <li><a href="#structural-form-1" id="toc-structural-form-1" class="nav-link" data-scroll-target="#structural-form-1">Structural form</a></li>
  <li><a href="#implementations" id="toc-implementations" class="nav-link" data-scroll-target="#implementations">Implementations</a></li>
  <li><a href="#comparison-with-pfa" id="toc-comparison-with-pfa" class="nav-link" data-scroll-target="#comparison-with-pfa">Comparison with PFA</a></li>
  <li><a href="#extension" id="toc-extension" class="nav-link" data-scroll-target="#extension">Extension</a></li>
  </ul></li>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation">Simulation</a>
  <ul class="collapse">
  <li><a href="#reduced-form-2" id="toc-reduced-form-2" class="nav-link" data-scroll-target="#reduced-form-2">Reduced form</a></li>
  <li><a href="#structural-form-2" id="toc-structural-form-2" class="nav-link" data-scroll-target="#structural-form-2">Structural form</a></li>
  </ul></li>
  <li><a href="#identification" id="toc-identification" class="nav-link" data-scroll-target="#identification">Identification</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a>
  <ul class="collapse">
  <li><a href="#irf" id="toc-irf" class="nav-link" data-scroll-target="#irf">IRF</a></li>
  <li><a href="#fevd" id="toc-fevd" class="nav-link" data-scroll-target="#fevd">FEVD</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#united-states" id="toc-united-states" class="nav-link" data-scroll-target="#united-states">United States</a>
  <ul class="collapse">
  <li><a href="#history" id="toc-history" class="nav-link" data-scroll-target="#history">History</a></li>
  <li><a href="#irf-1" id="toc-irf-1" class="nav-link" data-scroll-target="#irf-1">IRF</a></li>
  <li><a href="#fevd-1" id="toc-fevd-1" class="nav-link" data-scroll-target="#fevd-1">FEVD</a></li>
  </ul></li>
  <li><a href="#australia" id="toc-australia" class="nav-link" data-scroll-target="#australia">Australia</a>
  <ul class="collapse">
  <li><a href="#history-1" id="toc-history-1" class="nav-link" data-scroll-target="#history-1">History</a></li>
  <li><a href="#irf-2" id="toc-irf-2" class="nav-link" data-scroll-target="#irf-2">IRF</a></li>
  <li><a href="#fevd-2" id="toc-fevd-2" class="nav-link" data-scroll-target="#fevd-2">FEVD</a></li>
  </ul></li>
  <li><a href="#extension-1-narrative-restriction" id="toc-extension-1-narrative-restriction" class="nav-link" data-scroll-target="#extension-1-narrative-restriction">Extension 1: narrative restriction</a>
  <ul class="collapse">
  <li><a href="#history-2" id="toc-history-2" class="nav-link" data-scroll-target="#history-2">History</a></li>
  <li><a href="#irf-3" id="toc-irf-3" class="nav-link" data-scroll-target="#irf-3">IRF</a></li>
  <li><a href="#fevd-3" id="toc-fevd-3" class="nav-link" data-scroll-target="#fevd-3">FEVD</a></li>
  </ul></li>
  <li><a href="#extension-2-hierachical-prior-lambda" id="toc-extension-2-hierachical-prior-lambda" class="nav-link" data-scroll-target="#extension-2-hierachical-prior-lambda">Extension 2: hierachical prior <span class="math inline">\(\lambda\)</span></a>
  <ul class="collapse">
  <li><a href="#convergence-diagnostics" id="toc-convergence-diagnostics" class="nav-link" data-scroll-target="#convergence-diagnostics">Convergence diagnostics</a></li>
  <li><a href="#irf-4" id="toc-irf-4" class="nav-link" data-scroll-target="#irf-4">IRF</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sign and Zero Restrictions: Optimism Shock on the Australian Business Cycle</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam Wang </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<!-- latex shortcuts -->
<blockquote class="blockquote">
<p><strong>Abstract.</strong> This article investigates the effects of optimism shocks on the Australian economy using a Bayesian Structural Vector Autoregression (BSVAR) model. We implement the sign and zero restrictions algorithm proposed by <span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span> to identify the optimism shock. Impulse response functions (IRF) and forecast error variance decomposition (FEVD) are used to analyse the effects of the optimism shock on five key macroeconomic variables: productivity, stock prices, consumption, real interest rate and hours worked.</p>
<p><strong>Keywords.</strong> Bayesian Structural VAR, sign restrictions, zero restrictions, optimism shock</p>
</blockquote>
<!-- [Replication Package](https://www.econometricsociety.org/publications/econometrica/2018/03/01/inference-based-structural-vector-autoregressions-identified) -->
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p><strong>Objective</strong>: The goal of this research project is to implement the sign and zero restrictions algorithm proposed by <span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span> in the <a href="https://github.com/bsvars/bsvarSIGNs">bsvarSIGNs</a> package, and apply it to analyse the optimism shock to Australian economy.</p>
<p><strong>Question</strong>: Does optimism shocks drive the business cycles in Australian economy?</p>
<p><strong>Motivation</strong>: In macroeconomics, there has been a longstanding belief that fluctuations in business cycles can be largely attributed to episodes of optimism and pessimism. An optimism shock is defined as a positive shock to stock prices that does not affect productivity. Using a penalty function approach (PFA), <span class="citation" data-cites="beaudry2011mood">Beaudry, Nam, and Wang (<a href="#ref-beaudry2011mood" role="doc-biblioref">2011</a>)</span> finds significant evidence that optimism shocks are a key driver of business cycles in the United States as it creates a simultaneous boom in consumption and hours worked. But, <span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span> argue that PFA imposes additional restrictions, and they find less significant results using an importance sampler algorithm. This research project aims to extend the analysis to the Australian economy by implementing the importance sampler algorithm, and compare the results with United-States data.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<!-- load data -->
<!-- concat datasets -->
<p>All data are collected from the Reserve Bank of Australia (RBA), the Australian Bureau of Statistics (ABS) and Yahoo Finance. The sample period covers 1994 Q3 to 2023 Q4. Following <span class="citation" data-cites="beaudry2011mood">Beaudry, Nam, and Wang (<a href="#ref-beaudry2011mood" role="doc-biblioref">2011</a>)</span>, we select the following five variables for our analysis</p>
<ul>
<li><strong>Productivity</strong>: non-farm labour productivity per hour (source: RBA, series ID GNFPROSQI).</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_0421f45f085c661f4f3e3d9137fd5cbb">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="quarto-discovered-preview-image img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Productivity</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Stock prices</strong>: end-of-period ASX 200 index (source: Yahoo Finance, ticker symbol ^AXJO), divided by the consumer price index.</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_5d5d5b2f0c38cc7684c9d8a684966ed1">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Stock prices</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Consumption</strong>: retail turnover (source: ABS, series ID A3348585R), divided by the consumer price index.</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_d5fb27f534dd28c35c86d8162069b14b">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Consumption</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Real interest rate</strong>: over-night cash rate nets inflation (source: RBA, series ID FIRMMCRI and GCPIAGSAQP).</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_536643c92a247fc03d95a7e792163456">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Real interest rate</figcaption><p></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Hours worked</strong>: total hours worked (source: ABS, series ID A85389611R).</li>
</ul>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_91cb838527938f4c7f2cd1f7f859b3e4">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Hours worked</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The first two variables (productivity and stock prices) are chosen to identify the optimism shock, the last three variables (consumption, real interest rate and hours worked) are chosen to capture the business cycle dynamics as in standard macroeconomic theory.</p>
<p>To capture multiplicative relationships in macroeconomic time series and percentage change interpretation, all variables are log transformed (except for real interest rate). A preview of first 6 rows of the concatenated dataset is shown below.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_d2ebb12bee032f5ec55dff8c3b844625">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">date</th>
<th style="text-align: center;">productivity</th>
<th style="text-align: center;">stock_prices</th>
<th style="text-align: center;">consumption</th>
<th style="text-align: center;">real_interest_rate</th>
<th style="text-align: center;">hours_worked</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Sep 1994</td>
<td style="text-align: center;">4.2268</td>
<td style="text-align: center;">3.4527</td>
<td style="text-align: center;">4.9278</td>
<td style="text-align: center;">4.842</td>
<td style="text-align: center;">6.0222</td>
</tr>
<tr class="even">
<td style="text-align: center;">Dec 1994</td>
<td style="text-align: center;">4.2356</td>
<td style="text-align: center;">3.3870</td>
<td style="text-align: center;">4.9191</td>
<td style="text-align: center;">5.961</td>
<td style="text-align: center;">6.0143</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mar 1995</td>
<td style="text-align: center;">4.2254</td>
<td style="text-align: center;">3.3764</td>
<td style="text-align: center;">4.9315</td>
<td style="text-align: center;">5.892</td>
<td style="text-align: center;">6.0170</td>
</tr>
<tr class="even">
<td style="text-align: center;">Jun 1995</td>
<td style="text-align: center;">4.2121</td>
<td style="text-align: center;">3.4216</td>
<td style="text-align: center;">4.9487</td>
<td style="text-align: center;">6.209</td>
<td style="text-align: center;">6.0218</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sep 1995</td>
<td style="text-align: center;">4.2297</td>
<td style="text-align: center;">3.4635</td>
<td style="text-align: center;">4.9500</td>
<td style="text-align: center;">6.293</td>
<td style="text-align: center;">6.0199</td>
</tr>
<tr class="even">
<td style="text-align: center;">Dec 1995</td>
<td style="text-align: center;">4.2268</td>
<td style="text-align: center;">3.4968</td>
<td style="text-align: center;">4.9610</td>
<td style="text-align: center;">6.708</td>
<td style="text-align: center;">6.0164</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="acf-and-pacf-plot" class="level2">
<h2 class="anchored" data-anchor-id="acf-and-pacf-plot">ACF and PACF plot</h2>
<div class="cell" data-hash="index_cache/html/fig-acf-plot_76224672e7103429f8616718d48fdcfd">
<div class="cell-output-display">
<div id="fig-acf-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-acf-plot-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: ACF Plots</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The autocorrelation function (ACF) plot shows all variables have a consistent pattern of autocorrelation, this suggests that the time series are non-stationary. Stationarity is formally tested using the Augmented Dickey-Fuller test in the next section.</p>
<div class="cell" data-hash="index_cache/html/fig-pacf-plot_b976fb838920907ab243c80e8a469574">
<div class="cell-output-display">
<div id="fig-pacf-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-pacf-plot-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: PACF Plots</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The partial autocorrelation function (PACF) plot shows that the partial autocorrelation of all variables is significant at lag 1, real interest rate is also significant at lag 2. Therefore, choosing a lag length for the VAR model greater than or equal to 2 is reasonable, following convention for quarterly data, we will adopt a lag length of 4 for the VAR model.</p>
</section>
<section id="augmented-dickey-fuller-test" class="level2">
<h2 class="anchored" data-anchor-id="augmented-dickey-fuller-test">Augmented Dickey-Fuller test</h2>
<section id="level" class="level3">
<h3 class="anchored" data-anchor-id="level">Level</h3>
<p>All five variables are non-stationary at 5% significance level base on the Augmented Dickey-Fuller test.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_f92da49e715be4f42e5f74788b652fc9">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">non_stationary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">productivity</td>
<td style="text-align: right;">0.8093</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">stock_prices</td>
<td style="text-align: right;">0.1600</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">consumption</td>
<td style="text-align: right;">0.6469</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">real_interest_rate</td>
<td style="text-align: right;">0.3812</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hours_worked</td>
<td style="text-align: right;">0.0520</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="first-difference" class="level3">
<h3 class="anchored" data-anchor-id="first-difference">First difference</h3>
<p>Applying Augmented Dickey-Fuller test to the first difference of the variables, we find that all variables are stationary at 5% significance level. Therefore, all variables are integrated of order one <span class="math inline">\(I(1)\)</span> and it is reasonable to put them in a VAR system without further transformation.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_88dcad40e29531f67d46553c1b0b1191">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">non_stationary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">productivity</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">stock_prices</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">consumption</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">real_interest_rate</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hours_worked</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="model" class="level1">
<h1>Model</h1>
<section id="specification" class="level2">
<h2 class="anchored" data-anchor-id="specification">Specification</h2>
<p>Adopting notations from <span class="citation" data-cites="rubio2010structural">Rubio-Ramirez, Waggoner, and Zha (<a href="#ref-rubio2010structural" role="doc-biblioref">2010</a>)</span>, the SVAR model is specified as follows.</p>
<p>The endogenous variables are</p>
<p><span class="math display">\[
\mathbf{y}_t = [\text{productivity}_t,\ \text{stock prices}_t,\ \text{consumption}_t,\ \text{real interest rate}_t,\ \text{hours worked}_t]'
\]</span></p>
<section id="structural-form" class="level3">
<h3 class="anchored" data-anchor-id="structural-form">Structural form</h3>
<p><span class="math display">\[
\begin{align*}
\mathbf{y}_t' \mathbf{A}_0 &amp;= \sum_{l=1}^{p} \mathbf{y}_{t-l}'\mathbf{A}_l + \mathbf{c} + \boldsymbol{\varepsilon}_t' \\
\boldsymbol{\varepsilon}_t | \mathbf{Y}_{t-1} &amp;\overset{\text{iid}}{\sim} \mathcal{N}_N(\mathbf{0}, \mathbf{I})
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{y}_t\)</span> is an <span class="math inline">\(N\times1\)</span> vector of endogenous variables, <span class="math inline">\(\boldsymbol{\varepsilon}_t\)</span> is an <span class="math inline">\(N\times1\)</span> vector of exogenous structural shocks, <span class="math inline">\(\mathbf{A}_l\)</span> is an <span class="math inline">\(N\times N\)</span> matrix of parameters with <span class="math inline">\(\mathbf{A}_0\)</span> invertible, <span class="math inline">\(\mathbf{c}\)</span> is an <span class="math inline">\(1\times N\)</span> vector of parameters, and <span class="math inline">\(p\)</span> is the lag length, and <span class="math inline">\(T\)</span> is the sample size. This can be compactly written as</p>
<p><span class="math display">\[
\begin{align*}
\mathbf{y}_t' \mathbf{A}_0 &amp;= \mathbf{x}_t' \mathbf{A}_+ + \boldsymbol{\varepsilon}_t'
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{A}_+ = [\mathbf{A}_1'\ \cdots\ \mathbf{A}_p'\ \hspace{4mm}\mathbf{c}']\)</span> and <span class="math inline">\(\mathbf{x}_t = [\mathbf{y}_{t-1}'\ \cdots\ \mathbf{y}_{t-p}'\hspace{4mm}\ 1]\)</span>. The dimension of <span class="math inline">\(\mathbf{A}_+\)</span> is <span class="math inline">\(K\times N\)</span> where <span class="math inline">\(K=Np+1\)</span>.</p>
<p>In matrix form,</p>
<p><span class="math display">\[
\begin{align*}
\mathbf{Y} \mathbf{A}_0 &amp;= \mathbf{X} \mathbf{A}_+ + \boldsymbol{\varepsilon}\\
\boldsymbol{\varepsilon}| \mathbf{X} &amp;\sim \mathcal{MN}_{T\times N}(\mathbf{0}, \mathbf{I}_N, \mathbf{I}_T)
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{Y} = [\mathbf{y}_1\ \cdots\ \mathbf{y}_T]'\)</span>,&nbsp;<span class="math inline">\(\mathbf{X} = [\mathbf{x}_1\ \cdots\ \mathbf{x}_T]'\)</span>, and <span class="math inline">\(\boldsymbol{\varepsilon}= [\boldsymbol{\varepsilon}_1\ \cdots\ \boldsymbol{\varepsilon}_T]'\)</span>.</p>
<p>The matrices <span class="math inline">\(\mathbf{A}_0\)</span> and <span class="math inline">\(\mathbf{A}_+\)</span> are structural parameters.</p>
</section>
<section id="reduced-form" class="level3">
<h3 class="anchored" data-anchor-id="reduced-form">Reduced form</h3>
<p><span class="math display">\[
\begin{align*}
\mathbf{y}_t' &amp;= \mathbf{x}_t' \mathbf{B} + \mathbf{u}_t' \\
\mathbf{u}_t | \mathbf{Y}_{t-1} &amp;\overset{\text{iid}}{\sim} \mathcal{N}_N(\mathbf{0}, \mathbf{\Sigma})
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{B} = \mathbf{A}_ + \mathbf{A}_0^{-1},\ \mathbf{u}_t' = \boldsymbol{\varepsilon}_t' \mathbf{A}_0^{-1}\)</span>, and</p>
<p><span class="math display">\[
\mathbf{\Sigma }= \mathbb{E}[\mathbf{u}_t\mathbf{u}_t'] = (\mathbf{A}_0^{-1})' (\mathbf{A}_0^{-1}) = (\mathbf{A}_0 \mathbf{A}_0')^{-1}
\]</span></p>
<p>In matrix form,</p>
<p><span class="math display">\[
\begin{align*}
\mathbf{Y} &amp;= \mathbf{X} \mathbf{B} + \mathbf{u} \\
\mathbf{u} | \mathbf{X} &amp;\sim \mathcal{MN}_{T\times n}(\mathbf{0}, \mathbf{\Sigma}, \mathbf{I}_T)
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\mathbf{u} = [\mathbf{u}_1\ \cdots\ \mathbf{u}_T]'\)</span>.</p>
<p>The matrices <span class="math inline">\(\mathbf{B}\)</span> and <span class="math inline">\(\mathbf{\Sigma}\)</span> are reduced-form parameters.</p>
</section>
<section id="orthogonal-reduced-form-parameterization" class="level3">
<h3 class="anchored" data-anchor-id="orthogonal-reduced-form-parameterization">Orthogonal reduced-form parameterization</h3>
<p>Since SVAR model are identified up to a rotation matrix <span class="math inline">\(\mathbf{Q}\)</span>, we can explicitly specified the reduced-form model as</p>
<p><span class="math display">\[
\mathbf{y}_t' = \mathbf{x}_t' \mathbf{B} + \boldsymbol{\varepsilon}_t' \mathbf{Q}' h(\mathbf{\Sigma})
\]</span></p>
<p>Where <span class="math inline">\(\mathbf{Q}'h(\mathbf{\Sigma}) = \mathbf{A}_0^{-1}\)</span> or <span class="math inline">\(\mathbf{Q}=h(\mathbf{\Sigma}) \mathbf{A}_0\)</span>, and <span class="math inline">\(h\)</span> is some differentiable decomposition, one specific choice is the upper triangular Cholesky decomposition.</p>
<p>Then, we can define a mapping <span class="math inline">\(f_h\)</span> between the reduced-form parameters <span class="math inline">\((\mathbf{B}, \mathbf{\Sigma}, \mathbf{Q})\)</span> and structural-form parameters <span class="math inline">\((\mathbf{A}_0, \mathbf{A}_+)\)</span> as</p>
<p><span class="math display">\[
\begin{align*}
f_h(\mathbf{A}_0, \mathbf{A}_+) &amp;= (
  \underbrace{\mathbf{A}_+ \mathbf{A}_0^{-1}}_\mathbf{B},
  \underbrace{(\mathbf{A}_0 \mathbf{A}_0')^{-1}}_{\mathbf{\Sigma}},
  \underbrace{h((\mathbf{A}_0 \mathbf{A}_0')^{-1}) \mathbf{A}_0}_\mathbf{Q}
  ) \\
f_h^{-1}(\mathbf{B}, \mathbf{\Sigma}, \mathbf{Q}) &amp;= (
  \underbrace{h(\mathbf{\Sigma})^{-1} \mathbf{Q}}_{\mathbf{A}_0},
  \underbrace{\mathbf{B} h(\mathbf{\Sigma})^{-1} \mathbf{Q}}_{\mathbf{A}_+}
  )
\end{align*}
\]</span></p>
</section>
</section>
<section id="algorithm" class="level2">
<h2 class="anchored" data-anchor-id="algorithm">Algorithm</h2>
<section id="reduced-form-1" class="level3">
<h3 class="anchored" data-anchor-id="reduced-form-1">Reduced form</h3>
<p>The first step is to sample the reduced-form parameters (<span class="math inline">\(\mathbf{B}\)</span>, <span class="math inline">\(\mathbf{\Sigma}\)</span>). Adopting the conjugate Normal-Inverse-Wishart prior,</p>
<p><span class="math display">\[
\begin{align*}
\mathbf{B}|\mathbf{\Sigma }&amp;\sim \mathcal{MN}_{K\times N}(\underline{\mathbf{B}}, \underline{\mathbf{V}},\mathbf{\Sigma}) \\
\mathbf{\Sigma }&amp;\sim \mathcal{IW}_N(\underline{\mathbf{S}}, \underline{\nu})
\end{align*}
\]</span></p>
<p>and let</p>
<p><span class="math display">\[
\begin{align*}
\hat{\mathbf{B}} &amp;= (\mathbf{X}'\mathbf{X})^{-1}\mathbf{X}'\mathbf{Y} \\
\mathbf{R} &amp;= (\mathbf{Y}-\mathbf{X}\hat{\mathbf{B}})'(\mathbf{Y}-\mathbf{X}\hat{\mathbf{B}})
\end{align*}
\]</span></p>
<p>the conjugate posterior distribution can be derived from</p>
<p><span class="math display">\[\begin{align*}
p(\mathbf{B},\mathbf{\Sigma}|\mathbf{Y})

&amp;\propto |\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2}\text{tr}\left[ \mathbf{\Sigma}^{-1}(\mathbf{Y}-\mathbf{X}\mathbf{B})'(\mathbf{Y}-\mathbf{X}\mathbf{B}) \right] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2}\text{tr}[\mathbf{\Sigma}^{-1}(\mathbf{B}-\underline{\mathbf{B}})'\underline{\mathbf{V}}^{-1}(\mathbf{B}-\underline{\mathbf{B}})] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-(\underline\nu+N+1)/2}\exp\left\{ -\frac{1}{2} \text{tr}(\underline{\mathbf{S}}\mathbf{\Sigma}^{-1}) \right\} \\

&amp;\propto |\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2}\text{tr}\left[ \left( \mathbf{R}+(\mathbf{B}-\hat{\mathbf{B}})'\mathbf{X}'\mathbf{X}(\mathbf{B}-\hat{\mathbf{B}}) \right) \mathbf{\Sigma}^{-1} \right] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2}\text{tr}[(\mathbf{B}-\underline{\mathbf{B}})'\underline{\mathbf{V}}^{-1}(\mathbf{B}-\underline{\mathbf{B}})\mathbf{\Sigma}^{-1}] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-(\underline\nu+N+1)/2}\exp\left\{ -\frac{1}{2} \text{tr}(\underline{\mathbf{S}}\mathbf{\Sigma}^{-1}) \right\} \\

&amp;\propto |\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2} \text{tr}\left[ \left( (\mathbf{B}-\hat{\mathbf{B}})'\mathbf{X}'\mathbf{X}(\mathbf{B}-\hat{\mathbf{B}})+(\mathbf{B}-\underline{\mathbf{B}})'\underline{\mathbf{V}}^{-1}(\mathbf{B}-\underline{\mathbf{B}}) \right) \mathbf{\Sigma}^{-1} \right] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-(\underline\nu+T+N+1)/2}\exp\left\{ -\frac{1}{2}\text{tr}\left[ (\mathbf{R}+\underline{\mathbf{S}})\mathbf{\Sigma}^{-1} \right] \right\} \\

&amp;=|\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2} \text{tr}\left[ (\mathbf{B}-\overline{\mathbf{B}})'\overline{\mathbf{V}}^{-1}(\mathbf{B}-\overline{\mathbf{B}}) \mathbf{\Sigma}^{-1} \right] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-(\underline\nu+T+N+1)/2}\exp\left\{ -\frac{1}{2}\text{tr}\left[ (\mathbf{R}+\underline{\mathbf{S}}+\hat{\mathbf{B}}'\mathbf{X}'\mathbf{X}\hat{\mathbf{B}}+\underline{\mathbf{B}}'\underline{\mathbf{V}}^{-1}\underline{\mathbf{B}}-\overline{\mathbf{B}}'\overline{\mathbf{V}}^{-1}\overline{\mathbf{B}})\mathbf{\Sigma}^{-1} \right] \right\} \\

&amp;=|\mathbf{\Sigma}|^{-T/2}\exp\left\{ -\frac{1}{2} \text{tr}\left[ (\mathbf{B}-\overline{\mathbf{B}})'\overline{\mathbf{V}}^{-1}(\mathbf{B}-\overline{\mathbf{B}}) \mathbf{\Sigma}^{-1} \right] \right\} \\
&amp;\quad\times |\mathbf{\Sigma}|^{-(\underline\nu+T+N+1)/2}\exp\left\{ -\frac{1}{2}\text{tr}\left[ (\mathbf{Y}'\mathbf{Y}+\underline{\mathbf{S}}+\underline{\mathbf{B}}'\underline{\mathbf{V}}^{-1}\underline{\mathbf{B}}-\overline{\mathbf{B}}'\overline{\mathbf{V}}\overline{\mathbf{B}})\mathbf{\Sigma}^{-1} \right] \right\} \\

&amp;=p(\mathbf{B}|\mathbf{\Sigma},\mathbf{Y})\times p(\mathbf{\Sigma}|\mathbf{Y})
\end{align*}\]</span></p>
<p>Therefore, the posterior distribution of the reduced-form parameters is given by</p>
<p><span class="math display">\[
\begin{align*}
\mathbf{B}|\mathbf{\Sigma},\mathbf{Y} &amp;\sim \mathcal{MN}_{K\times N}(\overline{\mathbf{B}}, \overline{\mathbf{V}},\mathbf{\Sigma}) \\
\mathbf{\Sigma}|\mathbf{Y} &amp;\sim \mathcal{IW}_N(\overline{\mathbf{S}}, \overline{\nu})
\end{align*}
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\begin{align*}
\overline{\mathbf{B}} &amp;= \overline{\mathbf{V}}(\mathbf{X}'\mathbf{Y}+\underline{\mathbf{V}}^{-1}\underline{\mathbf{B}}) \\
\overline{\mathbf{V}} &amp;= (\mathbf{X}'\mathbf{X}+\underline{\mathbf{V}}^{-1})^{-1} \\
\overline{\mathbf{S}} &amp;= \underline{\mathbf{S}}+\mathbf{Y}'\mathbf{Y}+\underline{\mathbf{B}}'\underline{\mathbf{V}}^{-1}\underline{\mathbf{B}}-\overline{\mathbf{B}}'\overline{\mathbf{V}}^{-1}\overline{\mathbf{B}} \\
\overline{\nu} &amp;= \underline{\nu}+T
\end{align*}
\]</span></p>
</section>
<section id="structural-form-1" class="level3">
<h3 class="anchored" data-anchor-id="structural-form-1">Structural form</h3>
<p>To perform zero and sign restrictions, we need an algorithm to sample from the posterior distribution of the structural parameters (<span class="math inline">\(\mathbf{A}_0\)</span>, <span class="math inline">\(\mathbf{A}_+\)</span>) conditional on the zero and sign restrictions.</p>
<p>However, the set of structural parameters satisfying the zero restrictions is of Lebesgue measure zero in the set of all structural parameters (akin to <span class="math inline">\(\mathbb{P}(X=x)=0\)</span> for continuous <span class="math inline">\(X\)</span>). Luckily, we can sample the set of structural parameters satisfying the sign restrictions conditional on satisfying the zero restrictions.</p>
<p>Here is a high level outline of the algorithm proposed by <span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span>:</p>
<ol type="1">
<li>Sample reduced-form parameters <span class="math inline">\(\mathbf{B},\mathbf{\Sigma}\sim \mathcal{NIW}(\overline{\mathbf{B}},\overline{\mathbf{V}},\overline{\mathbf{S}},\overline{\mathbf{\nu}})\)</span>.</li>
<li>Sample <span class="math inline">\(\mathbf{Q}\)</span> conditional on the zero restrictions and set <span class="math inline">\((\mathbf{A}_0, \mathbf{A}_+) = f_h^{-1}(\mathbf{B}, \mathbf{\Sigma}, \mathbf{Q})\)</span>.</li>
<li>If the sign restrictions are satisfied, keep <span class="math inline">\((\mathbf{A}_0, \mathbf{A}_+)\)</span> and compute an importance weight, otherwise discard.</li>
<li>Repeat steps 1-3 until the desired number of samples is obtained.</li>
<li>Resample with replacement using the importance weights.</li>
</ol>
<p>Where step 5 (importance sampling) is needed to manipulate the density induced by step 1 to the desired Nomral-Generalized-Normal posterior density <span class="math inline">\(\mathcal{NGN}\)</span>.</p>
<p>To be explicit, starting with a Uniform-Normal-Inverse-Wishart prior distribution, the importance weight in step 3 is given by (posterior condition on <span class="math inline">\(\mathbf{Y}\)</span> is dropped for brevity):</p>
<p><span class="math display">\[
\begin{align*}
\frac{\mathcal{NGN}(\mathbf{A}_0,\mathbf{A}_+|\mathcal Z, \mathcal S)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}
&amp;=\frac{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal Z, \mathcal S)v_{f_h}(\mathbf{A}_0,\mathbf{A}_+)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}\\
&amp;\propto\frac{|\text{det}(\mathbf{A}_0)|^{-(2N+K+1)}}{v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\mathcal Z\)</span> denotes zero restrictions and <span class="math inline">\(\mathcal S\)</span> denotes sign restrictions. The numerator is the target density, and the denominator is the proposal density from steps 1-2.</p>
</section>
<section id="implementations" class="level3">
<h3 class="anchored" data-anchor-id="implementations">Implementations</h3>
<p>For computational efficiency, main functions in the <code>bsvarSIGNs</code> package are written in C++. The first function is compute posterior parameters as derived above.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="op">::</span>List niw_cpp<span class="op">(</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span> Y<span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span> X<span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> Rcpp<span class="op">::</span>List prior</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">int</span> T  <span class="op">=</span> Y<span class="op">.</span>n_rows<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  mat prior_B  <span class="op">=</span> as<span class="op">&lt;</span>mat<span class="op">&gt;(</span>prior<span class="op">[</span><span class="st">"B"</span><span class="op">]);</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  mat prior_V  <span class="op">=</span> as<span class="op">&lt;</span>mat<span class="op">&gt;(</span>prior<span class="op">[</span><span class="st">"V"</span><span class="op">]);</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  mat prior_S  <span class="op">=</span> as<span class="op">&lt;</span>mat<span class="op">&gt;(</span>prior<span class="op">[</span><span class="st">"S"</span><span class="op">]);</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> prior_nu <span class="op">=</span> as<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;(</span>prior<span class="op">[</span><span class="st">"nu"</span><span class="op">]);</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// analytic solutions</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  mat prior_V_inv <span class="op">=</span> inv_sympd<span class="op">(</span>prior_V<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  mat post_V_inv  <span class="op">=</span> prior_V_inv <span class="op">+</span> X<span class="op">.</span>t<span class="op">()</span> <span class="op">*</span> X<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  mat post_V      <span class="op">=</span> inv_sympd<span class="op">(</span>post_V_inv<span class="op">);</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  mat post_B      <span class="op">=</span> post_V <span class="op">*</span> <span class="op">(</span>X<span class="op">.</span>t<span class="op">()</span> <span class="op">*</span> Y <span class="op">+</span> prior_V_inv <span class="op">*</span> prior_B<span class="op">);</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">// marginal posterior of Sigma</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  mat post_S  <span class="op">=</span> prior_S <span class="op">+</span> Y<span class="op">.</span>t<span class="op">()</span> <span class="op">*</span> Y <span class="op">+</span> prior_B<span class="op">.</span>t<span class="op">()</span> <span class="op">*</span> prior_V_inv <span class="op">*</span> prior_B <span class="op">-</span> post_B<span class="op">.</span>t<span class="op">()</span> <span class="op">*</span> post_V_inv <span class="op">*</span> post_B<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  post_S      <span class="op">=</span> symmatu<span class="op">(</span>post_S<span class="op">);</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> post_nu <span class="op">=</span> prior_nu <span class="op">+</span> T<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> List<span class="op">::</span>create<span class="op">(</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    Named<span class="op">(</span><span class="st">"B"</span><span class="op">)</span>  <span class="op">=</span> post_B<span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    Named<span class="op">(</span><span class="st">"V"</span><span class="op">)</span>  <span class="op">=</span> post_V<span class="op">,</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    Named<span class="op">(</span><span class="st">"S"</span><span class="op">)</span>  <span class="op">=</span> post_S<span class="op">,</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    Named<span class="op">(</span><span class="st">"nu"</span><span class="op">)</span> <span class="op">=</span> post_nu</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The second function is to draw from the matrix normal distribution.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>arma<span class="op">::</span>mat rmatnorm_cpp<span class="op">(</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span> M<span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span> U<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span> V</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  mat X <span class="op">=</span> mat<span class="op">(</span>size<span class="op">(</span>M<span class="op">),</span> fill<span class="op">::</span>randn<span class="op">);</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> M <span class="op">+</span> chol<span class="op">(</span>U<span class="op">).</span>t<span class="op">()</span> <span class="op">*</span> X <span class="op">*</span> chol<span class="op">(</span>V<span class="op">);</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To draw from the inverse Wishart distribution, we use the <code>iwishrnd</code> function from the <code>RcppArmadillo</code> package. Using these three functions together, we are able to estimate the reduced-form BVAR model.</p>
<p>The following code calculates the volume element <span class="math inline">\(v_{(g\circ f_h)|\mathcal Z}\)</span> in the resampling step for the structural parameters</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> log_volume_element<span class="op">(</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>field<span class="op">&lt;</span>arma<span class="op">::</span>mat<span class="op">&gt;&amp;</span> Z<span class="op">,</span> <span class="co">//Field of matrices representing narrative restrictions</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span>              A0<span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>mat<span class="op">&amp;</span>              Aplus</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  colvec vec_structural <span class="op">=</span> join_vert<span class="op">(</span>vectorise<span class="op">(</span>A0<span class="op">),</span> vectorise<span class="op">(</span>Aplus<span class="op">));</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute the derivative of the narrative restrictions wrt the structural parameters</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  mat Dz  <span class="op">=</span> Df<span class="op">([</span>Z<span class="op">](</span><span class="at">const</span> colvec<span class="op">&amp;</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> zero_restrictions<span class="op">(</span>Z<span class="op">,</span> x<span class="op">);</span> <span class="op">},</span> vec_structural<span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute derivative of combined mapping function g_fh_vec wrt the structural parameters</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  mat Dgf <span class="op">=</span> Df<span class="op">([</span>Z<span class="op">](</span><span class="at">const</span> colvec<span class="op">&amp;</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> <span class="va">g_fh_vec</span><span class="op">(</span>Z<span class="op">,</span> x<span class="op">);</span> <span class="op">},</span> vec_structural<span class="op">);</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute the null space of the derivative of the narrative restrictions</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  mat DN  <span class="op">=</span> Dgf <span class="op">*</span> null<span class="op">(</span>Dz<span class="op">);</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Logarithm of determinant, then take the real part</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fl">0.5</span> <span class="op">*</span> log_det<span class="op">(</span>DN<span class="op">.</span>t<span class="op">()</span> <span class="op">*</span> DN<span class="op">).</span>real<span class="op">();</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="comparison-with-pfa" class="level3">
<h3 class="anchored" data-anchor-id="comparison-with-pfa">Comparison with PFA</h3>
<p>The PFA uses a loss function to find a rotation matrix <span class="math inline">\(\mathbf{Q}\)</span> that satisfies the zero restrictions and satisfies or close to satisfying the sign restrictions, thus it is not an exact solution. In comparison, the importance sampler algorithm is an exact solution satisfying all the restrictions.</p>
<p>Mathematically, the PFA solves the following minimization problem:</p>
<p><span class="math display">\[
\begin{aligned}
q^* &amp;= {\arg\min}_q \Psi(q) \quad s.t. (1)\ q'q=1,\ (2)\ R_{zero}q=0
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(q\)</span> is a column of <span class="math inline">\(\mathbf{Q}\)</span>. This step is analogous to steps 2-3 of the importance sampler algorithm. Intuitively, by minimizing <span class="math inline">\(\Psi(q)\)</span> we can find something close to satisfying the sign restrictions, condition (1) makes sure <span class="math inline">\(\mathbf{Q}\)</span> is orthogonal and condition (2) makes sure <span class="math inline">\(\mathbf{Q}\)</span> satisfies the zero restrictions.</p>
<p>Detailed definitions of <span class="math inline">\(\Psi\)</span> and <span class="math inline">\(R_{zero}\)</span> is beyond the scope of this project, but it is evident that the minimization problem gives an unique solution and therefore the PFA is not set-identifying <span class="math inline">\(\mathbf{Q}\)</span>.</p>
</section>
<section id="extension" class="level3">
<h3 class="anchored" data-anchor-id="extension">Extension</h3>
<p>Besides the zero and sign restrictions, another popular identification scheme proposed by <span class="citation" data-cites="antolin2018narrative">Antolı́n-Dı́az and Rubio-Ramı́rez (<a href="#ref-antolin2018narrative" role="doc-biblioref">2018</a>)</span> is to impose narrative restrictions on the structural shocks and historical decomposition. For example, restricting a structural shock to be negative during some period, and we will apply this to restrict the optimism shock during the Covid-19 pandemic.</p>
<p>But, the difficulty is that the narrative restrictions <span class="math inline">\(\mathcal{R}\)</span> requires another resample with some importance weight:</p>
<p><span class="math display">\[
\frac{1}{\omega(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})} \propto \frac{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal S, \mathcal R)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})}
\]</span></p>
<p>To combine these two identifications, we need to calculate the importance weight when <strong>all</strong> of the three restrictions, zero, sign, and narrative, are present. Intuitively, it is the product of the importance weight for the narrative restrictions and the importance weight for the zero and sign restrictions.</p>
<p>Here is an preliminary proof. The insight is to notice that <span class="math inline">\(\frac{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal Z, \mathcal S, \mathcal R)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal S, \mathcal R)}\propto 1\)</span> since adding zero restrictions does not change the likelihood and only truncates uniform conditional prior <span class="math inline">\(\pi(\mathbf{Q}|\mathbf{B},\mathbf{\Sigma})\)</span>.</p>
<p><span class="math display">\[
\begin{align*}
\frac{\mathcal{NGN}(\mathbf{A}_0,\mathbf{A}_+|\mathcal Z, \mathcal S, \mathcal R)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}
=&amp;\frac{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal Z, \mathcal S, \mathcal R)v_{f_h}(\mathbf{A}_0,\mathbf{A}_+)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}\\
=&amp;\frac{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal S, \mathcal R)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})}
\frac{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal Z, \mathcal S, \mathcal R)}{\mathcal{UNIW}(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}|\mathcal S, \mathcal R)}\\
&amp;\times
\frac{v_{f_h}(\mathbf{A}_0,\mathbf{A}_+)}{v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}\\
\propto&amp;\frac{1}{\omega(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})}\frac{v_{f_h}(\mathbf{A}_0,\mathbf{A}_+)}{v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}\\
\propto&amp;\frac{1}{\omega(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})}\frac{|\text{det}(\mathbf{A}_0)|^{-(2N+K+1)}}{v_{(g\circ f_h)|\mathcal Z}(\mathbf{A}_0,\mathbf{A}_+)}
\end{align*}
\]</span></p>
<p>The following code calculates <span class="math inline">\(\omega(\mathbf{B},\mathbf{\Sigma},\mathbf{Q})\)</span> for the narrative restrictions</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> weight_narrative<span class="op">(</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">int</span><span class="op">&amp;</span>                    T<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    arma<span class="op">::</span>mat                     sign_narrative<span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> arma<span class="op">::</span>cube<span class="op">&amp;</span>             irf</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">const</span> <span class="dt">int</span> M         <span class="op">=</span> <span class="fl">1e+04</span><span class="op">;</span>  <span class="co">// number of draws to approximate normal distribution</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span>    n_success <span class="op">=</span> <span class="fl">1.0e-15</span><span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  cube      Z<span class="op">(</span>irf<span class="op">.</span>n_rows<span class="op">,</span> sign_narrative<span class="op">.</span>col<span class="op">(</span><span class="dv">5</span><span class="op">).</span>max<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> M<span class="op">,</span> fill<span class="op">::</span>randn<span class="op">);</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// change all starting period to the first period</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// since we use the same M draws for all narrative restrictions</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  sign_narrative<span class="op">.</span>col<span class="op">(</span><span class="dv">4</span><span class="op">)</span> <span class="op">=</span> ones<span class="op">(</span>sign_narrative<span class="op">.</span>n_rows<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> m<span class="op">=</span><span class="dv">0</span><span class="op">;</span> m<span class="op">&lt;</span>M<span class="op">;</span> m<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>match_sign_narrative<span class="op">(</span>Z<span class="op">.</span>slice<span class="op">(</span>m<span class="op">),</span> sign_narrative<span class="op">,</span> irf<span class="op">))</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      n_success<span class="op">++;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> M <span class="op">/</span> n_success<span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span> provides a sufficient condition for the partial identification of the first <span class="math inline">\(k\)</span> shocks: at least <span class="math inline">\(N-j\)</span> zero restrictions and at least 1 sign restriction on the IRFs to the <span class="math inline">\(j\)</span>-th shock for <span class="math inline">\(1\le j\le k\)</span>. At this stage, there is no theoretical result how to incorporate narrative restrictions in this sufficient condition. Generally, narrative restrictions are used to sharpen the inference (i.e.&nbsp;narrower highest density interval) and does not make the structural shocks exactly identified.</p>
<p>If given some narrative restrictions there is an uniquely identified <span class="math inline">\(\mathbf{Q}^*\)</span>, step 3 of the importance sampling algorithm would never work, since the probability a randomly sampled <span class="math inline">\(\mathbf{Q}=\mathbf{Q}^*\)</span> is <span class="math inline">\(0\)</span>. In the later empirical work, we show the algorithm can still work with narrative restrictions, therefore at least the narrative restrictions considered here are not binding. But, the advantage of narrative (and sign) restrictions is that they are less controversial and the result can be agreed upon by more researchers.</p>
</section>
</section>
<section id="simulation" class="level2">
<h2 class="anchored" data-anchor-id="simulation">Simulation</h2>
<section id="reduced-form-2" class="level3">
<h3 class="anchored" data-anchor-id="reduced-form-2">Reduced form</h3>
<p>To test the validity of our code, we simulate 1,000 observations from a bi-variate Gaussian random walk process with the covariance matrix equal to the identity matrix of order 2.</p>
<p>Then, we compute 1,000 posterior draws from a SVAR model with a constant term and one lag, using the default identification scheme: positive sign restrictions on the diagonal of <span class="math inline">\(\mathbf{A}_0\)</span>.</p>
<p>The posterior mean of the <span class="math inline">\(\mathbf{B}\)</span> is</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_453e30915e522a144fc4eeb2c9dcb75f">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">y1</th>
<th style="text-align: right;">y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">y1_lag</td>
<td style="text-align: right;">0.9885</td>
<td style="text-align: right;">0.0052</td>
</tr>
<tr class="even">
<td style="text-align: left;">y2_lag</td>
<td style="text-align: right;">0.0027</td>
<td style="text-align: right;">0.9954</td>
</tr>
<tr class="odd">
<td style="text-align: left;">constant</td>
<td style="text-align: right;">0.0589</td>
<td style="text-align: right;">0.0822</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The posterior mean of <span class="math inline">\(\mathbf{\Sigma}\)</span> is</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_ca510bb872386251335384c83d9f4a3c">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">y1</th>
<th style="text-align: right;">y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">y1</td>
<td style="text-align: right;">0.9760</td>
<td style="text-align: right;">0.0881</td>
</tr>
<tr class="even">
<td style="text-align: left;">y2</td>
<td style="text-align: right;">0.0881</td>
<td style="text-align: right;">1.0146</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>They are close to the true values of the simulated data.</p>
</section>
<section id="structural-form-2" class="level3">
<h3 class="anchored" data-anchor-id="structural-form-2">Structural form</h3>
<p>Suppose the true structural model is</p>
<p><span class="math display">\[
\begin{bmatrix}
-1 &amp; 1\\
1 &amp; 0\\
\end{bmatrix}
\begin{bmatrix}
y_{1,t}\\
y_{2,t}\\
\end{bmatrix}
=
\begin{bmatrix}
-1 &amp; 1\\
1 &amp; 0\\
\end{bmatrix}
\begin{bmatrix}
y_{1,t-1}\\
y_{2,t-1}\\
\end{bmatrix}
+
\begin{bmatrix}
\varepsilon_{1,t}\\
\varepsilon_{2,t}\\
\end{bmatrix},
\begin{bmatrix}
\varepsilon_{1,t}\\
\varepsilon_{2,t}\\
\end{bmatrix}
\sim
\mathcal{N}(
\begin{bmatrix}
0 \\
0
\end{bmatrix}
,
\begin{bmatrix}
1 &amp; 0 \\
0 &amp; 1 \\
\end{bmatrix}
)
\]</span></p>
<p>equivalently, we can simulate 1,000 observations from the reduced-form</p>
<p><span class="math display">\[
\begin{bmatrix}
y_{1,t}\\
y_{2,t}\\
\end{bmatrix}
=
\begin{bmatrix}
1 &amp; 0\\
0 &amp; 1\\
\end{bmatrix}
\begin{bmatrix}
y_{1,t-1}\\
y_{2,t-1}\\
\end{bmatrix}
+
\begin{bmatrix}
u_{1,t}\\
u_{2,t}\\
\end{bmatrix},
\begin{bmatrix}
u_{1,t}\\
u_{2,t}\\
\end{bmatrix}
\sim
\mathcal{N}(
\begin{bmatrix}
0 \\
0
\end{bmatrix}
,
\begin{bmatrix}
1 &amp; 1 \\
1 &amp; 2 \\
\end{bmatrix}
)
\]</span></p>
<p>Putting zero and sign restrictions on the inverse of the structural matrix</p>
<p><span class="math display">\[
\begin{bmatrix}
-1 &amp; 1\\
1 &amp; 0\\
\end{bmatrix}^{-1}
=
\begin{bmatrix}
0 &amp; 1\\
1 &amp; 1\\
\end{bmatrix}
\Rightarrow
\begin{bmatrix}
0 &amp; +\\
+ &amp; +\\
\end{bmatrix}
\]</span></p>
<p>Posterior mean of 1,000 draws of the structural matrix is</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-17_58c8dc8493be6ac879e937ad38a89257">
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]   [,2]
[1,] -0.9614 1.0448
[2,]  0.9614 0.0000</code></pre>
</div>
</div>
</section>
</section>
<section id="identification" class="level2">
<h2 class="anchored" data-anchor-id="identification">Identification</h2>
<p>The following restrictions are imposed on the contemporaneous impulse response to identify the optimism shock.</p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 17%">
<col style="width: 26%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>Productivity</th>
<th>Stock prices</th>
<th>Consumption</th>
<th>Real interest rate</th>
<th>Hours worked</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Positive</td>
<td>Unrestricted</td>
<td>Unrestricted</td>
<td>Unrestricted</td>
</tr>
</tbody>
</table>
<p>The identification strategy is based on the assumption that the optimism shock positively affects stock prices, and has no contemporaneous effect on productivity.</p>
</section>
<section id="interpretation" class="level2">
<h2 class="anchored" data-anchor-id="interpretation">Interpretation</h2>
<p>Two popular methods to interpret the SVAR model are impulse response function (IRF) and forecast error variance decomposition (FEVD) <span class="citation" data-cites="kilian2017structural">(<a href="#ref-kilian2017structural" role="doc-biblioref">Kilian and Lütkepohl 2017</a>, Chap 4)</span>.</p>
<section id="irf" class="level3">
<h3 class="anchored" data-anchor-id="irf">IRF</h3>
<p>The impulse response function (IRF) of the SVAR model is used to interpret the effect of the optimism shock on the endogenous variables. Specifically, we are interested in whether a positive optimism shock leads to a simultaneous boom in consumption and hours worked (as in the United States).</p>
<p>Mathematically, the response of the <span class="math inline">\(i\)</span>-th variable to the <span class="math inline">\(j\)</span>-th shock at horizon <span class="math inline">\(k\)</span> is given by the element at row <span class="math inline">\(i\)</span> columns <span class="math inline">\(j\)</span> of <span class="math inline">\(\mathbf{\Theta}_k\)</span>, where <span class="math inline">\(\mathbf{\Theta}_k\)</span> is defined recursively as</p>
<span class="math display">\[\begin{aligned}&amp;\mathbf{\Theta}_{0} = \left(\mathbf{A}_{0}^{-1}\right)^{\prime},\quad\mathbf{\Theta}_{h} = \sum_{l=1}^{h}\bigl(\mathbf{A}_{\ell}\mathbf{A}_{0}^{-1}\bigr)^{\prime}\mathbf{\Theta}_{h-\ell},\quad\mathrm{} 1 \leq h \leq p,\\&amp;\mathbf{\Theta}_{h} = \sum_{\ell=1}^{p}\bigl(\mathbf{A}_{\ell}\mathbf{A}_{0}^{-1}\bigr)^{\prime}\mathbf{\Theta}_{h-\ell},\quad\mathrm{} p &lt; h &lt; \infty.\end{aligned}\]</span>
</section>
<section id="fevd" class="level3">
<h3 class="anchored" data-anchor-id="fevd">FEVD</h3>
<p>The forecast error variance decomposition (FEVD) is used to quantify the relative importance of the optimism shock in explaining the variability of a <span class="math inline">\(h\)</span>-step ahead forecast of a particular variable. For example, we will examine the proportion of the variability of consumption and hours worked explained by the optimism shock.</p>
<p>Mathematically, the <span class="math inline">\(i\)</span>-th variable’s forecast error variance decomposition of the <span class="math inline">\(j\)</span>-th shock at horizon <span class="math inline">\(h\)</span> is given by</p>
<p><span class="math display">\[
\text{FEVD}_j^i(h) = \frac{\text{MSFE}_{j}^{i}(h)}{\sum_{n=1}^{N}\text{MSFE}_{j}^{n}(h)}, \quad \text{MSFE}_{j}^{i}(h) = \sum_{l=0}^{h-1} \mathbf{\Theta}_{ij,l}^{2}
\]</span></p>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="united-states" class="level2">
<h2 class="anchored" data-anchor-id="united-states">United States</h2>
<p>First, we apply the package to the data from the United States, and replicate the results in <span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span>.</p>
<section id="history" class="level3">
<h3 class="anchored" data-anchor-id="history">History</h3>
<p>Historical values of the optimism shock is</p>
<div class="cell" data-hash="index_cache/html/us-shock_d0f4e0310881ea09ecfc4cbca28fa496">
<div class="cell-output-display">
<p><img src="index_files/figure-html/us-shock-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Most of the historical values of the optimism shock are not significantly different from 0, perhaps putting only one zero and one sign restriction is not enough to identify the optimism shock.</p>
</section>
<section id="irf-1" class="level3">
<h3 class="anchored" data-anchor-id="irf-1">IRF</h3>
<p>The impulse response functions are</p>
<div class="cell" data-hash="index_cache/html/us-irf_b1aa878677c46d6def1379f000512d3a">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/us-irf-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">US IRF (median and 68% highest density interval)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>which is very close to the ones in the original paper. Although consumption and hours worked have a boom in the median IRF, they are not significantly different from 0. Therefore, base on this identification strategy, the optimism shock does not drive business cycles in the US.</p>
</section>
<section id="fevd-1" class="level3">
<h3 class="anchored" data-anchor-id="fevd-1">FEVD</h3>
<p>Share of FEVD attributed to the optimism shock at horizon 40 (median 50%) and its 68% highest probability interval (16% and 84%) are</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_37b27653d47a864fbf77ff6f2715fff0">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">16%</th>
<th style="text-align: right;">50%</th>
<th style="text-align: right;">84%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">productivity</td>
<td style="text-align: right;">2.02</td>
<td style="text-align: right;">7.77</td>
<td style="text-align: right;">21.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">stock_prices</td>
<td style="text-align: right;">7.26</td>
<td style="text-align: right;">30.52</td>
<td style="text-align: right;">62.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">consumption</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: right;">17.17</td>
<td style="text-align: right;">52.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">real_interest_rate</td>
<td style="text-align: right;">6.39</td>
<td style="text-align: right;">17.21</td>
<td style="text-align: right;">38.98</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hours_worked</td>
<td style="text-align: right;">4.33</td>
<td style="text-align: right;">17.88</td>
<td style="text-align: right;">48.92</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>which is very close to the ones in the original paper. As the median values are relatively small (&lt;20%), the optimism shock does not contribute significantly to the FEVD of consumption and hours worked in the US.</p>
</section>
</section>
<section id="australia" class="level2">
<h2 class="anchored" data-anchor-id="australia">Australia</h2>
<p>All subsequent analysis are performed on the Australian data.</p>
<section id="history-1" class="level3">
<h3 class="anchored" data-anchor-id="history-1">History</h3>
<p>Historical values of the optimism shock is</p>
<div class="cell" data-hash="index_cache/html/au-shock_7320ab12a2183ecc27f9752271311534">
<div class="cell-output-display">
<p><img src="index_files/figure-html/au-shock-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Where the vertical dashed line indicates the period 2020 Q1. Although we have not impose any restriction here, the optimism shock is still significantly negative in 2020 Q1 i.e.&nbsp;the 68% highest density interval does not include zero, this is likely due to the Covid-19 pandemic.</p>
</section>
<section id="irf-2" class="level3">
<h3 class="anchored" data-anchor-id="irf-2">IRF</h3>
<p>The impulse response functions are</p>
<div class="cell" data-hash="index_cache/html/au-irf_29072ac48841038a7c5894ab6158af13">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/au-irf-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Australian IRF (median and 68% highest density interval)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Comparing to the US, the optimism shock has a much smaller effect on consumption and hours worked in Australia, only stock prices has a significant effect in the short run, other variables all have wide and symmetric IRFs around zero. Therefore, base on the same identification strategy, we conclude the optimism shock does not drive business cycles in Australia as well.</p>
</section>
<section id="fevd-2" class="level3">
<h3 class="anchored" data-anchor-id="fevd-2">FEVD</h3>
<p>Share of FEVD attributed to the optimism shock at horizon 40 (median 50%) and its 68% highest probability interval (16% and 84%) are</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_1e389dd6f2bb566da4346cd841a71cc3">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">16%</th>
<th style="text-align: right;">50%</th>
<th style="text-align: right;">84%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">productivity</td>
<td style="text-align: right;">1.33</td>
<td style="text-align: right;">7.30</td>
<td style="text-align: right;">25.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">stock_prices</td>
<td style="text-align: right;">3.63</td>
<td style="text-align: right;">13.17</td>
<td style="text-align: right;">34.95</td>
</tr>
<tr class="odd">
<td style="text-align: left;">consumption</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">9.23</td>
<td style="text-align: right;">23.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">real_interest_rate</td>
<td style="text-align: right;">10.48</td>
<td style="text-align: right;">27.09</td>
<td style="text-align: right;">47.85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hours_worked</td>
<td style="text-align: right;">4.11</td>
<td style="text-align: right;">11.54</td>
<td style="text-align: right;">26.33</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As the median values are relatively small (&lt;20%), the optimism shock does not contribute significantly to the FEVD of consumption and hours worked in Australia, which is a second evidence that the optimism shock does not drive business cycles in Australia.</p>
</section>
</section>
<section id="extension-1-narrative-restriction" class="level2">
<h2 class="anchored" data-anchor-id="extension-1-narrative-restriction">Extension 1: narrative restriction</h2>
<p>Now we introduce an additional narrative restriction that</p>
<blockquote class="blockquote">
<p>the optimism shock is <strong>negative</strong> when Covid-19 hits Australia in 2020 Q1.</p>
</blockquote>
<p>Since no one see the pandemic coming, and when it happens most people feel pessimistic due to many reasons. For example, being locked down in the house, losing jobs, and feeling uncertain about the future. An Australian national survey conducted in April 2020 <span class="citation" data-cites="fisher2020mental">(<a href="#ref-fisher2020mental" role="doc-biblioref">Fisher et al. 2020</a>)</span> finds 27.6% of people have clinically significant symptoms of depression, and 59.2% reported being more irritable. Therefore, it is reasonable to assume that the optimism shock is negative when Covid-19 hits Australia.</p>
<section id="history-2" class="level3">
<h3 class="anchored" data-anchor-id="history-2">History</h3>
<p>Historical values of the optimism shock is</p>
<div class="cell" data-hash="index_cache/html/au-ext-shock_c1368ae093bf8b76f54bb9d311a01238">
<div class="cell-output-display">
<p><img src="index_files/figure-html/au-ext-shock-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Where the vertical dashed line indicates the period 2020 Q1. Now all draws of the optimism shock are negative in 2020 Q1 due to the explicit narrative restriction, if we expand the highest density interval to 100% the interval will still not include zero. Comparing with the historical values of the optimism shock without the narrative restriction, here the highest density intervals are narrower but their overall shape are similar.</p>
<p>One interesting observation is that we see another two standard deviation pessimism shock around 2008, we did not impose any explicit narrative restriction here, but the model is likely picking up the effect of the global financial crisis.</p>
</section>
<section id="irf-3" class="level3">
<h3 class="anchored" data-anchor-id="irf-3">IRF</h3>
<p>The impulse response functions are</p>
<div class="cell" data-hash="index_cache/html/au-ext-irf_12442775e947007ba8bfb72723ba029e">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/au-ext-irf-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Australian IRF with narrative restriction (median and 68% highest density interval)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Although the median IRFs are slightly different from the previous case, the difference is not significant. After imposing the additional narrative restriction, the optimism shock still has no significant impact of the IRFs. Therefore, the conclusion that optimism shock does not drive business cycles in Australia is robust to the narrative restriction on Covid-19.</p>
</section>
<section id="fevd-3" class="level3">
<h3 class="anchored" data-anchor-id="fevd-3">FEVD</h3>
<p>Share of FEVD attributed to the optimism shock at horizon 40 (10 years) are</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-24_086a676b72ca2efb892f42523a05c76d">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">16%</th>
<th style="text-align: right;">50%</th>
<th style="text-align: right;">84%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">productivity</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">6.89</td>
<td style="text-align: right;">24.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">stock_prices</td>
<td style="text-align: right;">4.63</td>
<td style="text-align: right;">15.41</td>
<td style="text-align: right;">39.38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">consumption</td>
<td style="text-align: right;">2.70</td>
<td style="text-align: right;">8.90</td>
<td style="text-align: right;">22.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">real_interest_rate</td>
<td style="text-align: right;">10.38</td>
<td style="text-align: right;">27.54</td>
<td style="text-align: right;">49.22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hours_worked</td>
<td style="text-align: right;">4.13</td>
<td style="text-align: right;">12.16</td>
<td style="text-align: right;">24.86</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As the median values are relatively small (&lt;20%), the optimism shock does not contribute significantly to the FEVD of consumption and hours worked in Australia. This is similar the the previous case without the narrative restriction on Covid-19, and is another evidence that the optimism shock does not drive business cycles in Australia.</p>
</section>
</section>
<section id="extension-2-hierachical-prior-lambda" class="level2">
<h2 class="anchored" data-anchor-id="extension-2-hierachical-prior-lambda">Extension 2: hierachical prior <span class="math inline">\(\lambda\)</span></h2>
<p>Previous results have been implicitly relied on the choice of the hyperparameter <span class="math inline">\(\lambda\)</span> in the Minnesota prior:</p>
<p><span class="math display">\[
\underline{\mathbf{V}} = \text{diag}\left[\lambda^2 * \text{rep}(1,p)\otimes\psi \quad 10^6 \right]
\]</span></p>
<p>where we set <span class="math inline">\(\lambda = 0.2\)</span> and <span class="math inline">\(\psi\)</span> as the residual variances from independent AR(1) models. Now we impose a Gamma hierachical prior on <span class="math inline">\(\lambda\)</span> such that it peaks at around 0.2, specifically with scale and shape parameters:</p>
<p><span class="math display">\[
\lambda \sim \Gamma\left(\frac{9 + \sqrt{17}}{8}, \frac{8}{5(1 + \sqrt{17})}\right)
\]</span></p>
<p><span class="citation" data-cites="giannone2015prior">Giannone, Lenza, and Primiceri (<a href="#ref-giannone2015prior" role="doc-biblioref">2015</a>)</span> proposed a Metropolis algorithm to sample a vector of hyperparameters <span class="math inline">\(\gamma=(\mu,\delta,\lambda,\psi)\)</span> where <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\delta\)</span> are for dummy observation priors that will not be discussed here. A simplified version of their algorithm to sample <span class="math inline">\(\lambda\)</span> is as follows:</p>
<ol type="1">
<li>Initialize <span class="math inline">\(\lambda\)</span> by maximizing its log posterior, store the numerical Hessian matrix (scalar) <span class="math inline">\(W\)</span>.</li>
<li>Sample <span class="math inline">\(\lambda^*\sim\mathcal{N}(\lambda^{(s-1)},W)\)</span>.</li>
<li>Accept <span class="math inline">\(\lambda^{(s)}=\lambda^*\)</span> with probability <span class="math inline">\(\alpha = \min\left\{ 1, \frac{p(\lambda^*|\mathbf{Y})}{p(\lambda^{(s-1)}|\mathbf{Y})} \right\}\)</span>.</li>
</ol>
<p>Given the resulting sample <span class="math inline">\(\left\{ \lambda^{(s)} \right\}\)</span>, we can then proceed to sample <span class="math inline">\(\mathbf{B},\mathbf{\Sigma},\mathbf{Q}\)</span> by first taking a uniform draw from <span class="math inline">\(\left\{ \lambda^{(s)} \right\}\)</span>.</p>
<p>The following <code>R</code> code implements the above algorithm.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-25_1154348a3bad92392440a8ee962ae281">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>niw_prior <span class="ot">=</span> <span class="cf">function</span>(Y,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                     p,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                     non_stationary,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lambda =</span> <span class="fl">0.2</span>) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">=</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> N <span class="sc">*</span> p</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  B           <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, K, N)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  B[<span class="dv">1</span><span class="sc">:</span>N, <span class="dv">1</span><span class="sc">:</span>N] <span class="ot">=</span> <span class="fu">diag</span>(non_stationary)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  sigma2                  <span class="ot">=</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, \(i) <span class="fu">summary</span>(<span class="fu">lm</span>(Y[<span class="dv">2</span><span class="sc">:</span>T, i] <span class="sc">~</span> Y[<span class="dv">1</span><span class="sc">:</span>(T <span class="sc">-</span> <span class="dv">1</span>), i]))<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  V                       <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, K, K)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  V[K, K]                 <span class="ot">=</span> <span class="fl">1e+6</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  V[<span class="dv">1</span><span class="sc">:</span>(K <span class="sc">-</span> <span class="dv">1</span>), <span class="dv">1</span><span class="sc">:</span>(K <span class="sc">-</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="fu">diag</span>(lambda<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">kronecker</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^-</span><span class="dv">2</span>, sigma2<span class="sc">^-</span><span class="dv">1</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  S  <span class="ot">=</span> <span class="fu">diag</span>(sigma2)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">=</span> N <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">B =</span> B, <span class="at">V =</span> V, <span class="at">S =</span> S, <span class="at">nu =</span> nu)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>log_det <span class="ot">=</span> <span class="cf">function</span>(A) {</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">determinant</span>(A, <span class="at">logarithm =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>modulus</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>dlambda <span class="ot">=</span> <span class="cf">function</span>(lambda, p, Y, X) {</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  N     <span class="ot">=</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  T     <span class="ot">=</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">=</span> <span class="fu">niw_prior</span>(Y, p, <span class="fu">rep</span>(<span class="dv">1</span>, N), lambda)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  b     <span class="ot">=</span> prior<span class="sc">$</span>B</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  Omega <span class="ot">=</span> prior<span class="sc">$</span>V</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  Psi   <span class="ot">=</span> prior<span class="sc">$</span>S</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  d     <span class="ot">=</span> prior<span class="sc">$</span>nu</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  inv_Omega <span class="ot">=</span> <span class="fu">solve</span>(Omega)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  Bhat      <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">+</span> inv_Omega) <span class="sc">%*%</span> (<span class="fu">t</span>(X) <span class="sc">%*%</span> Y <span class="sc">+</span> inv_Omega <span class="sc">%*%</span> b)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  ehat      <span class="ot">=</span> Y <span class="sc">-</span> X <span class="sc">%*%</span> Bhat</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  lprior    <span class="ot">=</span> <span class="fu">dgamma</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    lambda,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> (<span class="dv">9</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">17</span>)) <span class="sc">/</span> <span class="dv">8</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">8</span> <span class="sc">/</span> (<span class="dv">5</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">17</span>))),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">log =</span> <span class="cn">TRUE</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  llike     <span class="ot">=</span> <span class="sc">-</span>N <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">log_det</span>(Omega)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  llike     <span class="ot">=</span> llike <span class="sc">-</span> N <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">log_det</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">+</span> inv_Omega)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  A         <span class="ot">=</span> Psi <span class="sc">+</span> <span class="fu">t</span>(ehat) <span class="sc">%*%</span> ehat <span class="sc">+</span> <span class="fu">t</span>(Bhat <span class="sc">-</span> b) <span class="sc">%*%</span> inv_Omega <span class="sc">%*%</span> (Bhat <span class="sc">-</span> b)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  llike     <span class="ot">=</span> llike <span class="sc">-</span> (T <span class="sc">+</span> d) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">log_det</span>(A)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lprior <span class="sc">+</span> llike)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>sample_lambda <span class="ot">=</span> <span class="cf">function</span>(S, p, Y, X) {</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  init   <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">optim</span>(</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    init,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    \(lambda) {</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>      nlogp <span class="ot">=</span> <span class="sc">-</span><span class="fu">dlambda</span>(lambda, p, Y, X)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(nlogp)) {</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        nlogp <span class="ot">=</span> <span class="fl">1e+6</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(nlogp)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">method  =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> init <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> init <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">hessian =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># control = list(trace = 1, maxit = 1e4)</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>  lambda    <span class="ot">=</span> <span class="fu">numeric</span>(S)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  lambda[<span class="dv">1</span>] <span class="ot">=</span> result<span class="sc">$</span>par</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>  dlambda   <span class="ot">=</span> result<span class="sc">$</span>value</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  c         <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  W         <span class="ot">=</span> c <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> result<span class="sc">$</span>hessian</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>S) {</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    new_lambda  <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, lambda[s <span class="sc">-</span> <span class="dv">1</span>], <span class="fu">sqrt</span>(W))</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>    new_dlambda <span class="ot">=</span> <span class="fu">dlambda</span>(new_lambda, p, Y, X)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">exp</span>(new_dlambda <span class="sc">-</span> dlambda)) {</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>      lambda[s] <span class="ot">=</span> new_lambda</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>      dlambda   <span class="ot">=</span> new_dlambda</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>      lambda[s] <span class="ot">=</span> lambda[s <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lambda)</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="convergence-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="convergence-diagnostics">Convergence diagnostics</h3>
<p>We sample 12,000 draws of <span class="math inline">\(\lambda\)</span> and discard the first 2,000 draws as burn-in. From the trace plot, we can see that the chain has converged to a stationary distribution.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-26_5a00c3ed328a8d99398e36dc98a29c95">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the histogram, we can see that the posterior distribution of <span class="math inline">\(\lambda\)</span> is centered around to 0.13, which shows the default choice of 0.2 is reasonable. On the other hand, since 0.13 is smaller than 0.2, the hirechical prior suggests more shrinkage than the default choice.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-27_d7ed5a6937cae9158ca17849d84184f5">
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="irf-4" class="level3">
<h3 class="anchored" data-anchor-id="irf-4">IRF</h3>
<p>The impulse response functions are</p>
<div class="cell" data-hash="index_cache/html/au-ext2-irf_5c2bf9551706a7a16907591abd9c08c9">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/au-ext2-irf-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Australian IRF with hierachical prior (median and 68% highest density interval)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>For simplicity, we only report the IRF in this extension. As the IRF is very similar to the previous results, our interpretation remains the same. By imposing the hierarchical prior on <span class="math inline">\(\lambda\)</span>, we let the data to choose the level of shrinkage and this shows the conclusion is robust to a more flexible prior.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In this report, we implement the sign and zero restrictions algorithm from <span class="citation" data-cites="arias2018inference">Arias, Rubio-Ramı́rez, and Waggoner (<a href="#ref-arias2018inference" role="doc-biblioref">2018</a>)</span>, extend it with narrative restrictions from <span class="citation" data-cites="antolin2018narrative">Antolı́n-Dı́az and Rubio-Ramı́rez (<a href="#ref-antolin2018narrative" role="doc-biblioref">2018</a>)</span> and hierarchical priors from <span class="citation" data-cites="giannone2015prior">Giannone, Lenza, and Primiceri (<a href="#ref-giannone2015prior" role="doc-biblioref">2015</a>)</span>. We replicate the result in the original paper using the US data, then apply the algorithm to the Australian data and found that the conclusion of optimism shock does not drive business cycles holds in the Australian economy. Furthermore, the conclusion is robust to (1) a narrative restriction on pessimism shock during the Covid-19 pandemic and (2) imposing a hierarchical prior on the shrinkage parameter <span class="math inline">\(\lambda\)</span>.</p>
</section>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-antolin2018narrative" class="csl-entry" role="listitem">
Antolı́n-Dı́az, Juan, and Juan F Rubio-Ramı́rez. 2018. <span>“Narrative Sign Restrictions for SVARs.”</span> <em>American Economic Review</em> 108 (10): 2802–29.
</div>
<div id="ref-arias2018inference" class="csl-entry" role="listitem">
Arias, Jonas E, Juan F Rubio-Ramı́rez, and Daniel F Waggoner. 2018. <span>“Inference Based on Structural Vector Autoregressions Identified with Sign and Zero Restrictions: Theory and Applications.”</span> <em>Econometrica</em> 86 (2): 685–720.
</div>
<div id="ref-beaudry2011mood" class="csl-entry" role="listitem">
Beaudry, Paul, Deokwoo Nam, and Jian Wang. 2011. <span>“Do Mood Swings Drive Business Cycles and Is It Rational?”</span> National Bureau of Economic Research.
</div>
<div id="ref-fisher2020mental" class="csl-entry" role="listitem">
Fisher, Jane RW, Thach D Tran, Karin Hammarberg, Jayagowri Sastry, Hau Nguyen, Heather Rowe, Sally Popplestone, Ruby Stocker, Claire Stubber, and Maggie Kirkman. 2020. <span>“Mental Health of People in Australia in the First Month of COVID-19 Restrictions: A National Survey.”</span> <em>Medical Journal of Australia</em> 213 (10): 458–64.
</div>
<div id="ref-giannone2015prior" class="csl-entry" role="listitem">
Giannone, Domenico, Michele Lenza, and Giorgio E Primiceri. 2015. <span>“Prior Selection for Vector Autoregressions.”</span> <em>Review of Economics and Statistics</em> 97 (2): 436–51.
</div>
<div id="ref-kilian2017structural" class="csl-entry" role="listitem">
Kilian, Lutz, and Helmut Lütkepohl. 2017. <em>Structural Vector Autoregressive Analysis</em>. Cambridge University Press.
</div>
<div id="ref-rubio2010structural" class="csl-entry" role="listitem">
Rubio-Ramirez, Juan F, Daniel F Waggoner, and Tao Zha. 2010. <span>“Structural Vector Autoregressions: Theory of Identification and Algorithms for Inference.”</span> <em>The Review of Economic Studies</em> 77 (2): 665–96.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>